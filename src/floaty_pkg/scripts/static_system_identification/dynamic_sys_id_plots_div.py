import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
import os

current_file_dir = os.path.dirname(os.path.realpath(__file__))
data_file_dir = current_file_dir +"/../../data/dynamic_system_identification/current_experiment/"
# data_file_dir = current_file_dir +"/../../data/dynamic_system_identification/current_experiment/ATI_data"
data_file_name = "/dynamic_sys_id_1_flap_signal_20_Hz_flap_7.5cm.csv"
# data_file_name = "/dynamic_sys_id_2_flap_signal_49.9_Hz_flap_7cm.csv"


# all_data = np.array([[0,0,0,0,0,0]])
# for folder_dir in folders_dir:

df = pd.read_csv(data_file_dir + data_file_name, header=None)
np_arr = df.to_numpy()

# max_freq = 60
# window_size = 600
max_freq = 200
window_size = 1999
# window_size = 2003
num_of_win_to_skip = 2
data_cols = np_arr.shape[1]
num_of_windows = int(np_arr.shape[0]/window_size)-1
# num_of_windows = 12
freqs = np.fft.fftfreq(window_size)*max_freq
x_axis = [j/10 for j in range(1,window_size)]

# window_size = 1000
# num_of_win_to_skip = 3
# num_of_windows = int(np_arr.shape[0]/window_size)
# # x_axis = [np.log10(j/10) for j in range(1,window_size//2)]
# # x_axis = [j/10 for j in range(1,window_size//2)]
# x_axis = [j/10 for j in range(1,window_size)]

# num_of_wins = (int)(np_arr.shape[0]/window_size)
num_of_wins = 4

fig, axis = plt.subplots(num_of_wins, 1, figsize=(20, 10))
data_id = 5
for i in range(num_of_wins):
    signal = np_arr[i*window_size:(i+1)*window_size, data_id]

    fft_res = np.fft.fft(signal)/len(signal)
    # fft_res = fft[range(int(len(signal)/2))]


    amps = np.abs(fft_res)
    angs = [np.angle(f) if (abs(amps[i])>0.0001) else 0 for (i,f) in enumerate(fft_res)]
    # axis[i].plot(freqs[1:], signal[1:window_size])
    # axis[i].plot(freqs[1:], 20*np.log10(amps[1:window_size]))
    axis[i].plot(freqs[1:window_size//2], 20*np.log10(amps[1:window_size//2]))
    # axis[i].plot(x_axis, amps[1:window_size])

plt.show()

fft_all = []
fft_avg = []
fft_std = []
ang_all = []
ang_avg = []

for i in range(data_cols):
    fft_arr = []
    amps_arr = []
    ang_arr = []
    for j in range(num_of_windows):
        signal = np_arr[j*window_size:(j+1)*window_size, i]
        # fft_res = np.fft.fft(signal)/len(signal)
        fft_res = np.fft.fft(signal)/len(signal)
        fft_arr.append(fft_res)
        amps =  np.abs(fft_res)
        amps_arr.append(amps)

        angs = np.angle(fft_res)
        ang_arr.append(angs)

    fft_all.append(fft_arr)
    ang_all.append(ang_arr)

    avg_freq = np.average(fft_arr[num_of_win_to_skip:],0)
    # avg_freq = np.average(amps_arr[num_of_win_to_skip:],0)
    std_freq = np.std(fft_arr[num_of_win_to_skip:],0)/(num_of_windows-num_of_win_to_skip)
    # std_freq = np.std(amps_arr[num_of_win_to_skip:],0)
    # fft_avg.append(avg_freq[:window_size//2])
    # fft_std.append(std_freq[:window_size//2])

    avg_ang = np.average(ang_arr[num_of_win_to_skip:],0)

    fft_avg.append(avg_freq[:window_size])
    fft_std.append(std_freq[:window_size])
    ang_avg.append(avg_ang[:window_size])


num_of_ang_win = 6
id = 2
diff_sum = []
fig, axis = plt.subplots(num_of_ang_win, 1, figsize=(20, 10))
for i in range(num_of_win_to_skip,num_of_ang_win+num_of_win_to_skip):
    ang_1 = ang_all[id][i]
    ang_2 = ang_all[id][i+1]
    diff_ang = ang_2 - ang_1
    diff_sum.append(diff_ang[window_size//20-1])
    axis[i-num_of_win_to_skip].scatter(freqs[:window_size//2], diff_ang[:window_size//2])
    # axis[i-num_of_win_to_skip].set_ylim(-1.5, 0.2)

diff_sum = np.sort(diff_sum)
diff_avg = diff_sum[num_of_ang_win//2]

plt.show()

if data_cols == 6:
    titles = ["x force", "y force", "z force", "x torque", "y torque", "z torque"]
else:
    titles = ["x pos", "y pos", "z pos", "x rot", "y rot", "z rot", "w rot"]
id = 5
fig, axis = plt.subplots(1, 1, figsize=(20, 10))

amps = np.abs(fft_avg[id])
stds = fft_std[id]

axis.plot(freqs[:window_size//2], 20*np.log10(amps[:window_size//2]))
axis.plot(freqs[:window_size//2], 20*np.log10(stds[:window_size//2]))

axis.set_ylabel("Magnitude (dB)")
axis.legend(["avg", "std"])
# axis.set_title(titles[id])
axis.set_xlabel("Frequency")



fig, axis = plt.subplots(data_cols, 1, figsize=(20, 10))
# data_id = 1

for i in range(data_cols):

    amps = np.abs(fft_avg[i])
    stds = fft_std[i]
    # angs = [np.angle(f) if (abs(amps[i])>0.0001) else 0 for (i,f) in enumerate(fft_res)]
    # axis[i].scatter(x_axis, amps[1:window_size])
    # axis[i].scatter(x_axis, stds[1:window_size])
    # axis[i].plot(freqs[1:window_size//2], amps[1:window_size//2])
    # axis[i].plot(freqs[1:window_size//2], stds[1:window_size//2])

    axis[i].plot(freqs[:window_size//2], 20*np.log10(amps[:window_size//2]))
    axis[i].plot(freqs[:window_size//2], 20*np.log10(stds[:window_size//2]))
    # axis[i].plot(x_axis, 20*np.log10(amps[1:window_size//2]))
    # axis[i].plot(x_axis, 20*np.log10(stds[1:window_size//2]))

    # min_amp = min(amps[1:window_size//2])
    # max_amp = max(amps[1:window_size//2])
    # axis[i].plot([10,10], [min_amp,max_amp])
    axis[i].set_ylabel("Magnitude (dB)")
    axis[i].legend(["avg", "std"])
    axis[i].set_title(titles[i])
axis[data_cols-1].set_xlabel("Frequency")
plt.show()

# smoothed_res = np.zeros([6,full_length])
# for i in range(full_length):
#     for j in range(6):
#         res = np.average(all_data[i*shift:i*shift+window_size,j])
#         smoothed_res[j,i] = res


# if full_length>1:
#     plt.plot(x_axis, smoothed_res[0,:])
#     plt.plot(x_axis, smoothed_res[1,:])
#     plt.plot(x_axis, smoothed_res[2,:])
#     plt.plot(x_axis, smoothed_res[3,:])
#     plt.plot(x_axis, smoothed_res[4,:])
#     plt.plot(x_axis, smoothed_res[5,:])
# else:
#     plt.scatter(x_axis, smoothed_res[0,0])
#     plt.scatter(x_axis, smoothed_res[1,0])
#     plt.scatter(x_axis, smoothed_res[2,0])
#     plt.scatter(x_axis, smoothed_res[3,0])
#     plt.scatter(x_axis, smoothed_res[4,0])
#     plt.scatter(x_axis, smoothed_res[5,0])

# plt.legend(["x force", "y force", "z force", "x torque", "y torque", "z torque"])
# print(np.average(all_data[:,2]))

# # plt.plot(x_axis, smoothed_res[2,:])
# # plt.legend(["z force"])

# # Freq 10 
# phases_flap1 = [0.0, 5.4823154, 0.70766927, 3.83930318, 2.33491238, 3.2841585, 3.70252365, 2.51784235, 2.47300607, 4.55180485, 3.98759886, 2.9065129, 1.29650902, 1.32419801, 5.789625, 3.60643198, 2.2933929, 0.4659472, 6.19324275, 0.82518683, 3.59785978, 3.82363654, 2.71251032, 6.2287491, 5.24833664, 5.70632999, 6.04226395, 1.14923711, 3.56814478, 4.6985938, 2.51977501, 3.8285286, 3.30420024, 3.17679944, 2.09794461, 6.1343656, 5.44310675, 4.58216756, 2.77366867, 3.50737521, 4.46043812, 3.0753117, 1.07844325, 4.84773071, 2.81433962, 5.49684992, 0.1264713, 3.6223602, 5.76146267, 0.54122173, 6.07472047, 1.57426502, 5.97162656, 4.6983733, 1.03739107, 3.21711251, 5.09942944, 0.61466418, 4.29785913, 3.467291, 0.14193866, 2.40578099, 2.33776842, 0.92917964, 5.39171078, 4.224261, 4.80679225, 4.79780297, 3.87080254, 3.54511687, 3.71151031, 5.3012424, 4.76096779, 0.49113356, 1.72797754, 0.21340503, 2.46070851, 2.8584847, 1.83636567, 0.09556078, 1.07276437, 4.44436884, 5.80481427, 0.4509532, 3.27165705, 2.62970188, 2.35105773, 6.01560685, 4.17000568, 5.8034949, 0.7684, 1.27050086, 2.8740506, 6.05806177, 4.7468419, 4.2290967, 0.75316695, 5.07745109, 6.23549294, 5.48313892, 4.43890742]
# phases_used = np.array([(ang+np.pi)%(2*np.pi)*(180/np.pi) for ang in phases_flap1])

# # Freq 49.9
# phases_flap1 = [0.0, 5.31627905, 3.19981217, 1.94347024, 2.09628496, 4.86961949, 5.22051589, 5.53162047, 5.65740492, 5.91096605, 0.204519528, 2.71693434, 3.83227687, 6.23703629, 0.206753347, 1.58029874, 1.1244472, 3.72090021, 5.57055651, 4.94676626, 0.720591641, 3.04736975, 1.80553801, 4.87323056, 5.4834993, 4.52844284, 1.40351248, 1.3417605, 4.45680397, 2.20769196, 5.02529176, 3.1578561, 1.98123457, 2.92335276, 0.992440171, 2.86564918, 5.84420976, 1.13104442, 3.66146208, 3.94003434, 4.63504932, 3.83503005, 3.37599233, 4.50912706, 4.81487687, 2.90595932, 3.60382437, 2.15177386, 6.27575517, 2.85353397, 2.83673157, 4.19887591, 4.97059087, 5.42868689, 3.64966122, 3.48354365, 0.528701046, 3.15784393, 4.86131071, 1.75547831, 3.20721033, 0.817357872, 0.510154376, 6.1618271, 5.96148605, 4.80767738, 5.09702276, 3.80435703, 0.0503505536, 3.19159649, 1.4249144, 4.13479637, 1.14132407, 5.09386711, 1.24882941, 4.76364332, 3.67560976, 0.393911772, 4.8406259, 6.28086298, 4.26524945, 2.69810631, 1.00020874, 6.09744893, 5.81498395, 5.20160292, 5.92931708, 6.25246266, 0.774915323, 6.02777283, 3.00301055, 5.04973076, 2.04266508, 5.78546932, 3.16303025, 4.63361349, 4.85539837, 0.0347058367, 5.43177611, 5.64426862, 2.37828733, 0.0994022151, 0.956909445, 5.7666881, 2.03002634, 4.44124518, 6.1341237, 5.71710634, 2.57515303, 1.32907797, 2.27644598, 5.11084672, 0.981796871, 5.04793805, 1.77032739, 2.44568359, 4.56585214, 4.12613942, 1.78532011, 4.14394522, 0.914400181, 5.3968248, 1.17314906, 2.0195427, 6.06770287, 6.13544954, 3.46275068, 2.64500765, 2.13624033, 4.14171328, 4.65525835, 5.97371636, 3.39722728, 4.806435, 0.588027544, 6.14532367, 3.16600198, 5.8756897, 5.43442679, 9.06982359, 0.847187411, 2.59182548, 1.03843404, 4.05164816, 0.676721846, 2.44467463, 1.8230904, 4.05960945, 1.67500923, 1.42816136, 2.24433409, 1.58689443, 0.980171547, 5.68285309, 2.44160395, 4.69330859, 0.618064098, 3.32831997, 5.34615342, 1.05894861, 4.25810411, 1.14924868, 4.41346431, 5.55669902, 5.83311685, 1.14834623, 1.06994031, 2.11572679, 2.74617882, 2.62975432, 3.98110754, 3.8949706, 1.77262266, 3.37583405, 1.02751979, 5.51971505, 5.84804885, 0.290648392, 2.51536942, 7.9803991, 1.70847679, 1.35206269, 4.1313407, 2.51348651, 3.81548099, 4.32258759, 4.54253321, 5.9591196, 1.80071955, 2.44033281, 2.74602535, 3.22567143, 3.3918807, 3.15686334, 5.32784241, 1.28072956, 4.01553288, 1.58165833, 5.72749696, 1.33500586, 3.64995158, 2.17800225, 0.888194357, 2.58904501, 6.06134143, 3.93973506, 2.3610702, 2.32115678, 0.00303502964, 6.0203491, 2.92139059, 5.95131631, 5.55210823, 1.09231697, 2.52496012, 1.83819103, 4.78757633, 0.476261932, 1.70739983, 5.34494033, 5.54870769, 1.56037141, 6.13219227, 3.50049271, 5.29254868, 1.24623272, 3.14571057, 5.86443789, 1.25985488, 2.94015602, 4.660817, 8.70739687, 1.35185478, 1.52551682, 0.413887717, 6.13079221, 4.35164398, 5.14126243, 0.137160777, 2.44544856, 3.69922178, 5.0001943, 5.1397903, 8.17624359, 4.82669357, 5.54060863, 5.78994124, 5.00390108, 1.53602828, 0.172654438, 3.66752342, 3.00749021, 0.969720324, 1.78872617, 4.78202257, 2.24754771, 4.71880117, 1.14219748, 0.974758907, 4.73948423, 0.107111961, 0.954214965, 0.46220207, 9.9795094, 3.65571301, 2.49945317, 1.03429894, 2.15556455, 5.12940962, 1.86460756, 0.0366190871, 1.61364255, 4.24736115, 1.86728605, 5.62159576, 5.52140799, 0.65020187, 4.29956366, 3.95432849, 2.26639105, 3.82161422, 3.11556573, 2.46829779, 3.44317724, 4.00404104, 2.55322434, 4.68353748, 5.4614552, 2.37053857, 6.25287612, 5.65312965, 5.11611604, 3.40149148, 6.21425988, 1.062692, 1.94401236, 1.19640473, 4.90160356, 0.808653749, 2.03677532, 3.81146831, 0.368089627, 4.59688446, 4.90030975, 3.55849305, 4.36807329, 0.39139074, 4.92127375, 2.03380342, 1.88059255, 5.36726092, 4.23473415, 3.59002886, 5.00324648, 5.74733073, 3.51047592, 5.57995655, 5.04599451, 2.15699774, 5.63040921, 0.841196146, 3.59521956, 2.0856883, 4.70600489, 0.915655922, 1.73668348, 5.28372435, 4.15387011, 0.172533358, 3.40354071, 1.00578683, 1.86016901, 5.05611682, 2.27388048, 1.22465678, 4.65161041, 3.37499185, 3.2270078, 5.12973324, 1.97929627, 1.54858172, 6.19024617, 5.83432941, 5.00645139, 5.8458506, 0.0440721117, 3.50216333, 4.95225493, 0.574091936, 4.87777582, 2.67489752, 5.04254097, 5.42011775, 2.08821887, 0.710457489, 4.48570084, 0.138487902, 4.97574323, 3.09805598, 5.78620023, 4.88924706, 0.501565393, 4.62042277, 2.08573172, 3.5746762, 2.06899689, 6.11737766, 1.77742206, 5.03450354, 0.502859067, 6.09232272, 4.00538325, 2.3470689, 5.52536377, 0.433343757, 4.85002506, 2.50292347, 5.93013194, 5.5915994, 2.2305712, 0.861214073, 4.41965855, 2.96349829, 3.28752381, 1.60331944, 1.96352729, 3.20303011, 1.40100305, 2.32542149, 5.23777526, 0.239975665, 5.64135865, 4.90133786, 0.526196752, 3.51523975, 1.80971754, 0.450797207, 0.879503213, 2.5435102, 1.7829074, 1.44776709, 0.130860891, 1.70880972, 5.05055424, 0.448456802, 2.71769746, 5.07772564, 3.0071224, 0.350659526, 5.40768056, 2.62319799, 6.11712679, 1.66415912, 1.74809168, 4.01145565, 3.77168046, 3.06867025, 5.13586493, 5.31501195, 4.55102499, 4.19452851, 0.271732899, 3.33898885, 2.72646152, 0.390247448, 4.94195399, 2.07521257, 4.64943998, 1.06522223, 5.30793616, 2.04999937, 1.81132058, 5.65554093, 3.78554921, 4.97360752, 1.96664656, 5.66727161, 3.6852542, 4.97983411, 4.63775722, 3.18688225, 3.98991705, 2.91149968, 5.85786446, 4.42859695, 4.94190923, 5.37972254, 3.35331037, 3.7067983, 1.46822952, 4.95270634, 3.86797474, 5.00621242, 1.8740409, 5.65276737, 2.94989006, 1.07114331, 3.69163216, 5.42733541, 1.59716773, 2.28504317, 6.07843481, 3.83987397, 6.19828677, 1.50473123, 0.527359906, 3.62198851, 4.30921272, 1.76455563, 0.986392585, 1.17441927, 7.10373067, 3.07214164, 2.35404686, 2.95737908, 7.39141344, 4.81266225, 2.04667553, 4.97677549, 2.1675725, 5.46049014, 5.71934709, 5.58726549, 5.58203281, 1.24212355, 3.96850888, 5.73573933, 3.84249924, 1.63372863, 5.2190688, 2.21689654, 3.5901915, 3.13070187, 0.73813259, 0.0837269833, 1.35418411, 5.45026202, 2.56960221, 0.930367559, 3.66630839]
# phases_used = np.array([(ang+np.pi)%(2*np.pi)*(180/np.pi) for ang in phases_flap1])

# # Freq 35
# phases_flap1 = [0.0, 6.2730659104599615, 2.9150099363664297, 0.08422950353572294, 2.9560264494186157, 5.249503115706995, 0.12479191695163382, 1.3053601240495356, 1.05759835402838, 5.655466227792095, 5.819739524672289, 0.45984105784995805, 0.862799991029414, 5.8584212512111, 1.1006588732388123, 0.0918647563045154, 3.127557633809049, 0.5666608650246346, 3.8842647152994503, 1.1693678160544678, 4.061576023200375, 2.838626664457121, 4.543139658915185, 0.5035341188290872, 2.719643311906353, 2.788096989802341, 6.164941787586879, 2.7120031173217645, 2.192370834020696, 6.0992187678480665, 3.8977965783424016, 3.0649247881065964, 3.309473742286169, 5.0664789090820355, 2.3010801545053448, 5.697363111263947, 3.6393060263383896, 4.163145119660824, 1.2516631119791073, 4.250110944290862, 0.45499212366225694, 5.524401107911023, 3.7673349567353993, 5.0920636024719865, 5.658057589784892, 3.711374432232566, 2.0978247979928724, 4.566813545243194, 5.762550767026464, 2.5712768714266176, 4.750471382490527, 0.17507787780285491, 4.902718044072911, 6.135287186651368, 2.3878773493046146, 6.210563322075887, 0.6120646578817112, 3.880249399321157, 0.5681870652481048, 1.2001448195427034, 3.180967857538914, 5.345875050069952, 0.7778358074257403, 1.9161819012020014, 5.066827638190364, 1.3699303071271351, 5.259058142930818, 1.7049636679137354, 1.7158975654770527, 4.292664403161506, 4.4976413794304495, 4.854044833080376, 1.2137872218440053, 3.465481838094962, 3.127427057248606, 5.797931298120904, 6.0068470798533, 5.913503782341177, 0.12302294040625772, 0.8362165820419071, 5.6409370165408275, 2.444613025406943, 4.858718068497515, 3.789688655431013, 0.9335878048527133, 5.535319411053805, 1.606993720939898, 2.076103668785135, 0.5702232448489185, 5.022139215256918, 6.090361201762806, 3.7234788374109162, 5.889439671291118, 2.2937349596201964, 0.8956217793309568, 1.4108006751607551, 0.22428974497464604, 2.3289334772399974, 6.192733747755978, 4.748929386897527, 0.9122828566502766, 0.8662452899960883, 1.4272513631165973, 3.1603747544651166, 5.688697289170913, 0.7107043278872521, 1.5676079426531222, 3.898693517746646, 2.7109709487656835, 5.460015280350464, 3.143279956878596, 3.193573881045039, 1.1497081304585268, 4.7503186578646215, 5.142363876264859, 5.974715810584853, 2.563881933730383, 4.479979172222173, 3.7577570119391126, 3.0748204513830513, 5.965532107638381, 5.071197187817204, 6.243459486425447, 5.763122158346065, 6.223478502231778, 1.901737657959374, 0.5638814077125694, 0.9805639747164693, 1.913107544286998, 3.6881364450647993, 5.648571549887385, 4.275847325511823, 2.395120221580342, 2.7907587563715994, 2.6124282637329785, 2.1929457830855967, 0.5786079756355169, 4.961144484151094, 6.111690201757687, 0.47703496730617495, 2.7806513674687348, 0.7148129706117707, 1.29394815753065, 1.5206605824731176, 6.146664771889511, 0.20075557551942247, 6.169256763878862, 3.026956170932132, 5.648184746510798, 3.0772958922316853, 1.9615055478479244, 5.141506840213972, 3.7046927761113855, 1.2200939853259787, 2.5895161555770874, 3.830421689135396, 2.8342607087040195, 5.26967017473468, 2.1505625959741392, 3.2605418931895285, 1.4918781080947094, 5.373885074395382, 2.8489097391040925, 1.6529474275999219, 3.3860939318511774, 0.9178958918771477, 4.264336136216236, 4.206252627515873, 4.561774551812255, 1.3535458849592794, 5.095677940481246, 5.572741033247868, 2.9696758790980686, 2.7051602973556124, 5.574011704026148, 5.041798894300756, 5.928275912752991, 3.6251866654731133, 0.34518352469500524, 2.792299489425603, 0.019236985528015647, 5.465866684453625, 6.175709195809417, 3.302792545885585, 0.9507239056084003, 5.7121682563901155, 3.9071077622051846, 4.537479042718374, 2.1028692776017652, 5.840038473796556, 2.8258696396250755, 6.273394823311048, 2.3434779265437067, 2.8523801409274934, 1.374573080044458, 2.7027990630073826, 5.3063212514856035, 4.295895468377083, 3.6024164700737757, 4.735080447706681, 1.1089785415104723, 4.073122794550077, 0.20919441061560878, 3.291654143526138, 4.794332871417297, 5.512605438050595, 3.9557693374405796, 6.238339539642641, 1.1309111176193427, 1.6208549431731891, 1.3431319733454132, 2.864129024487347, 1.1559203067576382, 6.111390894533714, 1.713449112194159, 4.291785504770007, 4.121666229310216, 4.639222065166565, 5.35809548773437, 4.773260659310839, 0.8537906325951081, 5.439379783253313, 2.4836483839747325, 1.1038209311874994, 3.3415050098230275, 2.7262289297540945, 0.8482333150222958, 1.610901613306717, 2.3044152140886176, 0.5288220491953275, 4.647766195391867, 2.3398150453510156, 5.8155082237334055, 6.231498037105463, 2.5678373028285337, 6.093425868206418, 5.829572031994486, 4.192891673634512, 4.250043369499406, 3.94041720569676, 0.966437998226783, 2.127790531132657, 0.8307627788332111, 2.9423350235748753, 4.832265274110496, 1.4799682199074762, 5.4354228947329375, 3.7677003286770936, 0.29933534295998904, 5.202766821379176, 1.2427103953603693, 4.150049624521568, 1.6834987891977693, 0.4998358491553272, 5.61938412125249, 5.86974475404003, 1.4113954003571012, 4.573965364869904, 1.5777017908855218, 0.9706721552289079, 1.6210166801480879, 2.5227904615120624, 3.2180688221282114, 6.14019972427112, 3.4458764803152095, 5.291496599967962, 4.546248082062655, 3.7074782975237937, 1.6705683278916645, 4.561591753797904, 1.0075936860320218, 4.147863284531368, 5.265467455942506, 5.6541367312672905, 0.7794373820829843, 5.202333329527063, 4.082964587900926, 2.28198178670988, 2.37145968164571, 4.0891422235628845, 2.2958236653492117, 3.098763055887933, 0.5632032189640616, 3.8014038851963243, 4.097351465858931, 2.1522292201347004, 5.533221366478563, 1.3645015705563655, 5.708122717251962, 1.1586749785755721, 5.5698845574303775, 1.3550615432350108, 3.956785451329957, 5.1353442383924595, 6.270710236829798, 1.662824262268943, 2.3310926549114472, 1.9287491314588407, 0.6734580222049579, 5.209961209288362, 0.7474604666449118, 4.484420201666548, 3.2414356323612883, 5.858758653092344, 1.480784749384959, 5.626232540498283, 2.7777702982124697, 5.116237574725298, 1.2009093461099143, 5.5927230859501975, 5.7011877846119114, 5.486504031538956, 2.928035357847946, 0.35455307060792934, 1.9951853923513603, 2.008488164856426, 0.6845450469082495, 4.442421250062232, 2.3361560713770793, 1.9552664150711336, 5.114992003513546, 3.4268457283789013, 4.077890988675765, 6.257569295561957, 0.8970704068657767, 5.821154598764871, 3.2060179882559474, 5.8869053456973885, 5.471043284484871, 1.2251962869328175, 2.0608608733795473, 6.050961017196959, 1.0472104739465664, 1.4914526479492278, 1.1859374363166002, 0.013047918117712103, 4.823282149895949, 0.32855389397542506, 5.277344572651531, 3.4473209524751214, 5.066310134329944, 5.809023978441365, 5.263075967097358, 2.928295959419236, 4.226689278727011, 5.970027671714913, 2.924772690603557, 5.7090183472248865, 4.273739167945464, 2.4047234107992126, 5.104359666515918]
# phases_flap2 = [0.0, 3.1314732568701693, 6.056602589956222, 3.225822157125516, 6.097619103008409, 2.107910462117202, 3.266384570541427, 4.4469527776393285, 4.1991910076181735, 2.513873574202302, 2.6781468710824967, 3.601433711439751, 4.004392644619207, 2.7168285976213067, 4.242251526828605, 3.2334574098943083, 6.269150287398842, 3.708253518614428, 0.7426720617096567, 4.310960469644261, 0.9199833696105815, 5.980219318046914, 1.4015470053253916, 3.6451267724188803, 5.861235965496146, 5.929689643392134, 3.023349133997087, 5.853595770911557, 5.3339634876104896, 2.9576261142582734, 0.756203924752608, 6.2065174416963895, 0.16788108869637597, 1.9248862554922432, 5.442672808095137, 2.5557704576741536, 0.4977133727485965, 1.0215524660710305, 4.393255765568901, 1.1085182907010687, 3.5965847772520503, 2.3828084543212302, 0.6257423031456062, 1.9504709488821934, 2.5164649361950993, 0.5697817786427724, 5.239417451582666, 1.4252208916534013, 2.6209581134366715, 5.71286952501641, 1.6088787289007342, 3.316670531392648, 1.7611253904831177, 2.993694533061575, 5.529470002894408, 3.068970668486095, 3.753657311471504, 0.7386567457313635, 3.709779718837898, 4.341737473132497, 0.03937520394912042, 2.20428239648016, 3.919428461015533, 5.057774554791795, 1.9252349846005714, 4.5115229607169285, 2.1174654893410256, 4.846556321503528, 4.857490219066846, 1.151071749571713, 1.3560487258406564, 1.7124521794905831, 4.3553798754337985, 0.3238891845051688, 6.269019710838399, 2.656338644531111, 2.8652544262635065, 2.771911128751384, 3.2646155939960506, 3.9778092356317, 2.4993443629510352, 5.586205678996736, 1.7171254149077217, 0.6480960018412194, 4.075180458442507, 2.3937267574640124, 4.748586374529691, 5.217696322374929, 3.7118158984387115, 1.8805465616671242, 2.948768548173014, 0.5818861838211227, 2.747847017701325, 5.4353276132099895, 4.0372144329207496, 4.552393328750548, 3.3658823985644393, 5.470526130829791, 3.0511410941661836, 1.6073367333077337, 4.053875510240069, 4.007837943585882, 4.56884401670639, 0.018782100875323948, 2.547104635581121, 3.8522969814770454, 4.7092005962429155, 0.7571008641568531, 5.852563602355477, 2.318422626760672, 0.0016873032888025108, 0.05198122745524536, 4.29130078404832, 1.6087260042748284, 2.0007712226750662, 2.833123156995061, 5.705474587320176, 1.3383865186323796, 0.6161643583493195, 6.216413104972844, 2.8239394540485883, 1.929604534227412, 3.101866832835654, 2.6215295047562712, 3.081885848641985, 5.043330311549167, 3.7054740613023625, 4.1221566283062625, 5.054700197876791, 0.5465437914750062, 2.5069788962975927, 1.1342546719220294, 5.536712875170135, 5.9323514099613925, 5.754020917322771, 5.334538436675389, 3.7202006292253103, 1.819551830561302, 2.970097548167894, 3.618627620895968, 5.922244021058528, 3.856405624201564, 4.435540811120443, 4.662253236062911, 3.0050721182997187, 3.3423482291092155, 3.02766411028907, 6.168548824521926, 2.5065920929210037, 6.218888545821478, 5.103098201437717, 1.9999141866241779, 0.5631001225215924, 4.361686638915772, 5.73110880916688, 0.688829035545603, 5.975853362293813, 2.1280775211448866, 5.292155249563932, 0.11894923959973536, 4.633470761684503, 2.2322924208055888, 5.990502392693886, 4.794540081189715, 0.24450127826138424, 4.059488545466941, 1.1227434826264426, 1.06465997392608, 1.420181898222462, 4.495138538549073, 1.954085286891452, 2.431148379658076, 6.111268532687862, 5.8467529509454055, 2.432419050436355, 1.900206240710963, 2.7866832591631976, 0.4835940118833202, 3.4867761782847984, 5.933892143015396, 3.1608296391178086, 2.3242740308638314, 3.034116542219625, 0.1611998922957918, 4.092316559198194, 2.5705756028003215, 0.7655151086153911, 1.3958863891285809, 5.244461931191559, 2.6984458202067625, 5.967462293214869, 3.1318021697212544, 5.4850705801335, 5.993972794517287, 4.516165733634251, 5.844391716597176, 2.1647285978958095, 1.1543028147872896, 0.4608238164839822, 1.5934877941168875, 4.250571195100266, 0.9315301409602839, 3.350787064205402, 0.15006148993634483, 1.6527402178275041, 2.3710127844608024, 0.8141766838507865, 3.0967468860528484, 4.272503771209136, 4.762447596762982, 4.484724626935206, 6.0057216780771405, 4.297512960347431, 2.96979824094392, 4.855041765783952, 1.150192851180214, 0.9800735757204233, 1.4976294115767717, 2.2165028341445776, 1.6316680057210462, 3.995383286184901, 2.2977871296635186, 5.625241037564526, 4.2454135847772925, 0.19991235623323433, 5.867821583343888, 3.989825968612089, 4.752494266896511, 5.446007867678411, 3.670414702785121, 1.5061735418020739, 5.481407698940808, 2.6739155701436133, 3.0899053835156707, 5.709429956418327, 2.9518332146166237, 2.687979378404693, 1.051299020044719, 1.1084507159096129, 0.798824552106967, 4.108030651816576, 5.26938318472245, 3.9723554324230044, 6.083927677164668, 1.6906726205207026, 4.62156087349727, 2.2938302411431444, 0.6261076750873009, 3.440927996549782, 2.061174167789382, 4.384303048950162, 1.0084569709317748, 4.825091442787563, 3.6414285027451205, 2.4777914676626978, 2.728152100450238, 4.552988053946894, 1.4323727112801112, 4.719294444475315, 4.112264808818701, 4.762609333737881, 5.664383115101856, 0.07647616853841832, 2.9986070706813273, 0.3042838267254169, 2.149903946378169, 1.4046554284728616, 0.565885643934001, 4.812160981481457, 1.419999100208111, 4.149186339621815, 1.0062706309415752, 2.123874802352713, 2.5125440776774965, 3.9210300356727776, 2.0607406759372697, 0.9413719343111326, 5.423574440299673, 5.513052335235503, 0.9475495699730914, 5.437416318939005, 6.2403557094777256, 3.704795872553855, 0.6598112316065308, 0.9557588122691376, 5.293821873724493, 2.391628712888771, 4.506094224146159, 2.566530063662169, 4.300267632165365, 2.4282919038405844, 4.496654196824804, 0.8151927977401634, 1.9937515848026663, 3.1291175832400047, 4.804416915858736, 5.472685308501241, 5.070341785048634, 3.815050675794751, 2.0683685556985694, 3.889053120234705, 1.3428275480767553, 0.09984297877149473, 2.7171659995025514, 4.622377402974752, 2.4846398869084894, 5.919362951802263, 1.9746449211355053, 4.342501999699707, 2.4511304323604044, 2.5595951310221174, 2.3449113779491633, 6.0696280114377394, 3.4961457241977225, 5.136778045941154, 5.150080818446219, 3.826137700498043, 1.3008285964724386, 5.477748724966872, 5.096859068660927, 1.9733993499237528, 0.2852530747891082, 0.9362983350859722, 3.115976641972164, 4.03866306045557, 2.6795619451750774, 0.0644253346661543, 2.7453126921075963, 2.329450630895078, 4.366788940522611, 5.20245352696934, 2.9093683636071646, 4.188803127536359, 4.6330453015390205, 4.327530089906393, 3.154640571707505, 1.6816894963061557, 3.4701465475652182, 2.135751919061738, 0.30572829888532826, 1.924717480740151, 2.667431324851572, 2.1214833135075644, 6.069888613009029, 1.0850966251372176, 2.82843501812512, 6.0663653441933505, 2.5674256936350943, 1.1321465143556706, 5.546316064389005, 1.9627670129261254]


# # Freq 20
phases_flap1 = [0.0, 6.115943936136099, 2.964398910102509, 5.878499633668316, 4.324867520677149, 3.011688908892953, 0.06552023102829851, 5.965820686862114, 1.1680985142491191, 1.6226282757417618, 2.855838452624464, 2.2097977067905084, 1.1136621131996272, 6.074563846882073, 4.4699254587148065, 3.0727116717144614, 6.203456505076838, 2.7482998375020133, 1.130869883132844, 1.4563201485971964, 3.764389191137162, 0.4478944318467267, 0.6565081090975422, 1.9150797866745457, 0.9166032722179261, 3.3925322858868308, 5.999258493549281, 1.378624396733785, 3.185860378551435, 4.778214961369039, 0.20620446830433287, 4.058392079098809, 4.046940888371212, 4.7363982064534715, 0.3886933637837829, 5.988541228930593, 4.8139440226239625, 5.841632008281709, 2.302586126986355, 6.178097622597426, 1.766006643141424, 5.778666706366896, 5.437731086558211, 4.971868223452187, 0.4965285736899246, 5.9623140063825995, 0.583691828678179, 2.1265775389313633, 2.3391250610940304, 4.422025103671458, 0.7782228344348859, 5.214214737396185, 0.6166376581306974, 4.421538620023024, 1.3008613064652963, 0.20195738434266425, 3.4926845019468566, 2.8326315124458747, 2.4398991545862723, 2.9823099158121247, 1.690524786608212, 3.789060677336329, 4.86803445701393, 6.079097391669076, 3.3131624191763844, 1.5645254150617969, 4.487264243929568, 5.425452807583636, 0.5152077089628333, 1.6724198860188908, 0.7908396973499723, 3.780489222546827, 4.743608761053609, 3.056903537452557, 5.33511745512867, 4.704233719293239, 3.5666047500617144, 2.0754251023446386, 4.141673668456137, 3.3109422666202093, 1.0409485903320463, 2.1301444334878674, 1.9493877682963383, 6.057028333246856, 2.522109549473329, 1.6941521738053762, 1.6237927983859122, 3.2115997128973253, 0.6878867965477843, 5.6713512797220025, 2.3595766688097055, 4.645910059277516, 4.164389823157254, 5.83085859733993, 5.190508142193207, 1.489300327812597, 5.687566336413266, 2.667775151325579, 4.93419321440541, 5.533967160386469, 3.8644047268611095, 4.554035662665014, 2.2548184366567114, 6.149319131863997, 4.492282642359933, 6.051534679443484, 0.8125111231185851, 1.2000896500469904, 5.069083450753599, 1.195909037205941, 4.63666206193019, 0.9242167003777574, 2.846028918322214, 4.662342647695986, 4.374668969999036, 5.4651728121044885, 5.947079363291495, 0.49188914611440543, 1.830285929406533, 0.21420322414681583, 5.364476360652317, 1.5383524525773513, 3.923038846486987, 6.258688649875832, 5.685508333888696, 4.227667487457329, 2.7934972148621147, 0.4472087542207671, 5.771336360104417, 3.829070772107639, 5.767299598956016, 6.0848779233145915, 0.44999011166065694, 4.663585548969782, 2.89946387289201, 2.6835458076687684, 2.078984901649125, 5.789931590534594, 4.8282689550526845, 4.688774340430113, 0.7146487677067864, 3.962558486662135, 5.089995155565854, 3.003247920090836, 4.120088405399229, 0.14464265718388944, 2.4198517367409487, 5.630268708067967, 2.8489326345990453, 0.9040543584445928, 0.16564448550690195, 1.102573547933749, 0.6202626189574393, 0.6014877493518198, 0.6774229283178004, 0.6238583830956461, 5.816476039556619, 5.95587863387248, 3.746905209355009, 5.33513904775773, 3.5458560520634257, 6.182542459260235, 0.7199014741663268, 1.676162686922378, 5.156976729486002, 4.507486431453438, 5.561760842049789, 6.105428075966669, 0.36004032784672774, 5.700702531322829, 3.1490407327272534, 0.46234198288890105, 4.138527468190023, 0.17086586517010666, 2.5679835149367314, 5.364818210299512, 4.360804616627769, 1.17271925367506, 3.0036260616150416, 5.119829137979135, 1.2284052510509138, 6.128957611053765, 4.289884291513583, 1.9413621642883123, 5.322541913325138, 6.22207790847578, 1.7596870102304487, 4.32328692664232, 0.2584968586610289, 5.227443984799462, 3.1614722435356204, 4.841501806977914, 6.201696687620485, 1.5073715422058351, 2.360735996349481, 5.815354152620119, 2.4600518325417657, 1.183999434745276, 4.493047305362316, 4.817535882839861, 3.038302346550168]
# phases_flap2 = [0.0, 2.974351282546305, 6.105991563692302, 2.7369069800785226, 1.1832748670873556, 6.153281562482746, 3.2071128846180916, 2.8242280332723197, 4.3096911678389125, 4.764220929331555, 5.997431106214258, 5.351390360380302, 4.25525476678942, 2.93297119329228, 1.3283328051250134, 6.214304325304255, 3.061863851487045, 5.889892491091807, 4.272462536722637, 4.59791280218699, 0.6227965375473694, 3.5894870854365197, 3.7981007626873353, 5.056672440264339, 4.058195925807719, 0.25093963229703764, 2.8576658399594876, 4.520217050323578, 0.04426772496164233, 1.6366223077792457, 3.347797121894126, 0.9167994255090157, 0.9053482347814192, 1.5948055528636784, 3.530286017373576, 2.8469485753408, 1.6723513690341694, 2.700039354691917, 5.444178780576149, 3.036504969007634, 4.907599296731217, 2.637074052777102, 2.2961384329684176, 1.830275569862394, 3.6381212272797177, 2.8207213527928054, 3.725284482267972, 5.268170192521156, 5.4807177146838235, 1.2804324500816646, 3.919815488024679, 2.072622083806392, 3.7582303117204905, 1.2799459664332309, 4.442453960055089, 3.343550037932457, 0.3510918483570631, 5.974224166035668, 5.581491808176065, 6.123902569401918, 4.832117440198005, 0.6474680237465353, 1.7264418034241373, 2.9375047380792836, 0.17156976558659132, 4.70611806865159, 1.3456715903397747, 2.2838601539938423, 3.6568003625526266, 4.814012539608684, 3.9324323509397656, 0.6388965689570334, 1.6020161074638155, 6.19849619104235, 2.193524801538878, 1.5626410657034455, 0.42501209647192084, 5.217017755934432, 1.0000810148663435, 0.16934961303041618, 4.18254124392184, 5.2717370870776605, 5.090980421886131, 2.9154356796570617, 5.6637022030631226, 4.835744827395169, 4.765385451975705, 0.0700070593075317, 3.8294794501375775, 2.5297586261322103, 5.501169322399498, 1.5043174056877229, 1.0227971695674611, 2.6892659437501365, 2.048915488603413, 4.63089298140239, 2.5459736828234725, 5.809367804915372, 1.7926005608156181, 2.392374506796676, 0.7228120732713164, 1.4124430090752211, 5.396411090246504, 3.007726478274204, 1.3506899887701396, 2.9099420258536917, 3.9541037767083784, 4.341682303636784, 1.9274907971638058, 4.337501690795734, 1.495069408340397, 4.06580935396755, 5.9876215719120065, 1.5207499941061933, 1.2330763164092433, 2.3235801585146945, 2.805486709701702, 3.6334817997041986, 4.971878582996326, 3.355795877736609, 2.2228837070625236, 4.679945106167144, 0.7814461928971941, 3.1170959962860394, 2.543915680298902, 1.086074833867536, 5.935089868451907, 3.58880140781056, 2.629743706514624, 0.6874781185178458, 2.625706945366222, 2.9432852697247984, 3.59158276525045, 1.5219928953799888, 6.041056526481803, 5.825138461258561, 5.220577555238918, 2.6483389369448, 1.6866763014628914, 1.5471816868403199, 3.8562414212965797, 0.8209658330723419, 1.9484025019760605, 6.144840573680629, 0.9784957518094357, 3.2862353107736824, 5.561444390330742, 2.488676054478173, 5.990525288188838, 4.045647012034386, 3.3072371390966953, 4.244166201523543, 3.7618552725472325, 3.743080402941613, 3.8190155819075935, 3.7654510366854392, 2.674883385966826, 2.814285980282687, 0.6053125557652157, 2.193546394167937, 0.404263398473633, 3.040949805670442, 3.86149412775612, 4.817755340512171, 2.0153840758962076, 1.3658937778636453, 2.4201681884599964, 2.963835422376876, 3.501632981436521, 2.559109877733036, 0.007448079137460262, 3.6039346364786944, 0.9969348146002295, 3.3124585187599, 5.7095761685265245, 2.2232255567097177, 1.219211963037976, 4.3143119072648535, 6.145218715204835, 1.9782364843893419, 4.369997904640707, 2.9873649574639707, 1.1482916379237897, 5.082954817878106, 2.180949259735346, 3.0804852548859856, 4.901279663820242, 1.1816942730525266, 3.400089512250822, 2.0858513312096676, 0.019879589945826837, 1.6999091533881208, 3.060104034030692, 4.648964195795628, 5.502328649939274, 2.673761499030327, 5.601644486131558, 4.325592088335069, 1.3514546517725226, 1.675943229250068, 6.179895000139961]

phases_used = np.array([ang*(180/np.pi) for ang in phases_flap1])
# phases_used2 = np.array([ang*(180/np.pi) for ang in phases_flap2])
phases_used2 = np.array([(ang+180)%(360) for ang in phases_used])



fig, axis = plt.subplots(2, 1, figsize=(20, 10))
data_id = 2

amps = np.abs(fft_avg[data_id])
stds = fft_std[data_id]
angs = [np.angle(freq_complex) for freq_complex in fft_avg[data_id]]
degrees = [(ang_val*180/np.pi + 360)%360 for ang_val in angs]

# degrees = [(ang_val*180/np.pi + 360)%360 for ang_val in angs]
# degrees = [(ang_val*180/np.pi) for ang_val in angs]


freqs_num_to_plot = len(phases_flap1)
change_in_phase = degrees[:freqs_num_to_plot]-phases_used
for i, shift in enumerate(change_in_phase):
    if shift<-360:
        change_in_phase[i]=shift+360
    elif shift>= 0:
        change_in_phase[i]=shift-360

axis[0].scatter(np.log10(freqs[:freqs_num_to_plot]), 20*np.log10(amps[:freqs_num_to_plot]))
axis[0].scatter(np.log10(freqs[:freqs_num_to_plot]), 20*np.log10(stds[:freqs_num_to_plot]))

axis[1].scatter(np.log10(freqs[:freqs_num_to_plot]), change_in_phase)

axis[0].set_title(titles[data_id])
axis[0].set_ylabel("Amplitude in dB")

axis[1].set_xlabel("log10 freq")
axis[1].set_ylabel("Phase in degrees")


print("Done!")
